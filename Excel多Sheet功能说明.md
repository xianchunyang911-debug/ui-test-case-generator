# Excel多Sheet功能使用说明

## 功能概述

现在应用支持两种输出格式：
1. **CSV格式**：单文件，所有用例在一个表格中
2. **Excel多Sheet格式**：多工作表，按模块分组，支持下拉选择和自动统计

## Excel多Sheet格式特点

### 1. 自动按模块分组
- 每个模块一个独立的Sheet
- Sheet按照业务流程顺序排列
- 第一个Sheet是"用例汇总"，显示所有模块的统计信息

### 2. 用例汇总Sheet
包含以下信息：
- 序号
- 模块名称
- 用例数量
- 高/中/低优先级数量
- **完成数量**（自动统计）
- **完成率**（自动计算）
- 备注

### 3. 各模块Sheet
每个模块Sheet包含：
- 用例编号
- 页面/模块
- 检查点
- 设计原则
- 检查项
- 优先级（带颜色标识）
- 预期结果/设计标准
- **是否通过**（下拉选择：待测试/是/否）
- 截图/备注

### 4. 自动统计功能
- 在各模块Sheet中选择"是否通过"（是/否）
- "用例汇总"Sheet会自动更新完成数量和完成率
- 无需手动计算

## 使用步骤

### 1. 生成Excel文件

1. 上传需求文档
2. 选择输出格式：
   - **🤖 自动选择**：用例>50或模块>3时自动使用Excel多Sheet
   - **📊 Excel多Sheet格式**：强制使用Excel多Sheet
   - **📄 CSV格式**：使用CSV格式
3. 点击"生成UI走查用例"
4. 下载生成的Excel文件

### 2. 执行UI走查

1. 打开下载的Excel文件
2. 查看"用例汇总"Sheet，了解整体情况
3. 按Sheet顺序执行走查：
   - 跨域训练首页
   - 新建跨域训练任务
   - 跨域训练任务详情
   - ...
4. 在"是否通过"列选择测试结果：
   - **待测试**：尚未执行
   - **是**：通过验证
   - **否**：存在问题
5. 在"截图/备注"列记录问题描述

### 3. 查看进度

1. 切换到"用例汇总"Sheet
2. 查看各模块的完成数量和完成率
3. 完成率会自动更新，无需手动计算

## 在线操作功能

除了下载Excel文件，应用还提供在线操作功能：

### 1. 模块完成进度
- 实时显示各模块的统计信息
- 用例总数、已完成、通过、未通过
- 完成率、通过率

### 2. 用例详情
- 按模块查看用例
- 在线选择"是否通过"
- 实时更新统计信息

### 3. 使用场景
- **快速验证**：在线操作，无需下载
- **团队协作**：多人同时查看进度
- **实时统计**：即时了解完成情况

## 格式对比

| 特性 | CSV格式 | Excel多Sheet格式 |
|------|---------|------------------|
| 文件大小 | 小 | 较大 |
| 模块分组 | ❌ | ✅ |
| 下拉选择 | ❌ | ✅ |
| 自动统计 | ❌ | ✅ |
| 颜色标识 | ❌ | ✅ |
| 适用场景 | 简单项目 | 复杂项目 |

## 注意事项

1. **Sheet名称限制**：Excel的Sheet名称不能超过31个字符
2. **自动统计**：选择"是"或"否"后，汇总表会自动更新
3. **保存文件**：修改后记得保存Excel文件
4. **兼容性**：需要Excel 2007及以上版本

## 示例

### 用例汇总Sheet示例

| 序号 | 模块名称 | 用例数量 | 高优先级 | 中优先级 | 低优先级 | 完成数量 | 完成率 | 备注 |
|------|----------|----------|----------|----------|----------|----------|--------|------|
| 1 | 跨域训练首页 | 20 | 15 | 3 | 2 | 18 | 90% | |
| 2 | 新建跨域训练任务 | 25 | 20 | 4 | 1 | 20 | 80% | |
| 3 | 跨域训练任务详情 | 18 | 12 | 5 | 1 | 10 | 56% | |

### 模块Sheet示例

| 用例编号 | 页面/模块 | 检查点 | 设计原则 | 检查项 | 优先级 | 预期结果/设计标准 | 是否通过 | 截图/备注 |
|----------|-----------|--------|----------|--------|--------|-------------------|----------|-----------|
| UI-TC001 | 跨域训练首页 | 页面标题 | 视觉一致性原则 | 检查标题字体、字号、颜色 | 高 | 字号16px，字重500，颜色#262626 | 是 | |
| UI-TC002 | 跨域训练首页 | 按钮状态 | 组件状态完整性原则 | 检查按钮的各种状态 | 高 | 有默认、悬停、点击、禁用状态 | 否 | 缺少禁用状态 |

## 常见问题

### Q1: 为什么选择了Excel多Sheet，但下载的还是CSV？
A: 请检查：
1. 是否在"选择格式"中选择了"Excel多Sheet格式"
2. 是否等待生成完成（会有"生成完成"提示）
3. 查看下载按钮的文件名，应该是.xlsx结尾

### Q2: 完成率没有自动更新？
A: 请确保：
1. 在"是否通过"列选择了"是"或"否"（不是"待测试"）
2. 保存了Excel文件
3. 刷新或重新打开文件

### Q3: 在线操作的数据会保存吗？
A: 在线操作的数据保存在浏览器会话中，刷新页面会丢失。如需永久保存，请下载Excel文件并在Excel中操作。

## 技术实现

- 使用 `openpyxl` 库生成Excel文件
- 使用Excel公式实现自动统计
- 使用数据验证实现下拉选择
- 使用条件格式实现颜色标识

## 更新日志

### v1.0 (2024-11-10)
- ✅ 支持Excel多Sheet格式生成
- ✅ 按模块自动分组
- ✅ 用例汇总Sheet
- ✅ 自动统计完成率
- ✅ 下拉选择"是否通过"
- ✅ 在线操作和统计功能
